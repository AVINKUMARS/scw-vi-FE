import { useState } from 'react'
import { Link, useNavigate } from 'react-router-dom'
import { api } from '../lib/api'
import { saveToken } from '../lib/auth'
import FormInput from '../components/FormInput'
import { beginSso } from '../lib/auth'

export default function Login() {
  const nav = useNavigate()
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [loading, setLoading] = useState(false)
  const [err, setErr] = useState('')

  const onSubmit = async (e: React.FormEvent) => {
    e.preventDefault(); setErr(''); setLoading(true)
    try {
      const { data } = await api.post('/auth/login', { email, password })
      saveToken(data.token)
      nav('/home')
    } catch (e: any) { setErr(e?.response?.data?.error ?? 'Login failed') }
    finally { setLoading(false) }
  }

  return (
    <div className="max-w-md mx-auto mt-24 grid gap-4 px-4">
      <h1 className="text-2xl font-bold">Scalingwolf AI</h1>
      <h2 className="text-lg font-semibold">Login</h2>
      <form onSubmit={onSubmit} className="grid gap-3">
        <FormInput label="Email" type="email" value={email} onChange={e => setEmail(e.target.value)} required />
        <FormInput label="Password" type="password" value={password} onChange={e => setPassword(e.target.value)} required />
        <button disabled={loading} className="px-4 py-3 rounded-lg text-white bg-gradient-to-r from-brand1 via-brand2 to-brand3 disabled:opacity-60">Login</button>
        {err && <p className="text-red-600 dark:text-red-400">{err}</p>}
      </form>
      <div className="flex items-center gap-3 my-2">
        <div className="flex-1 h-px bg-neutral-200 dark:bg-neutral-700" />
        <span className="text-neutral-500 text-sm">or</span>
        <div className="flex-1 h-px bg-neutral-200 dark:bg-neutral-700" />
      </div>
      <div className="grid gap-2">
        <button
          type="button"
          onClick={() => beginSso('google')}
          className="px-4 py-3 rounded-lg border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 hover:bg-neutral-50 dark:hover:bg-neutral-800"
        >
          Continue with Google
        </button>
        <button
          type="button"
          onClick={() => beginSso('microsoft')}
          className="px-4 py-3 rounded-lg border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 hover:bg-neutral-50 dark:hover:bg-neutral-800"
        >
          Continue with Microsoft
        </button>
      </div>
      <p>Donâ€™t have an account? <Link to="/register" className="text-brand2">Register</Link></p>
    </div>
  )
}
